<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ვიქტორინა</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; color: white; text-align: center; padding: 20px; }
        .controls { margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .controls button { padding: 12px 20px; background: #f1c40f; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: #2c3e50; }
        #quiz-container { max-width: 800px; margin: 0 auto; }
        .question-card { background: white; padding: 25px; border-radius: 15px; color: #333; text-align: left; border-left: 8px solid #1a2a6c; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .timer-container { display: flex; align-items: center; gap: 10px; margin: 15px 0; background: #f8f9fa; padding: 8px; border-radius: 5px; }
        .timer-display { font-size: 1.4rem; font-weight: bold; color: #e74c3c; }
        .ans-text { display: none; margin-top: 15px; color: #27ae60; font-weight: bold; border-top: 2px solid #eee; padding-top: 10px; }
        .q-img { max-width: 100%; border-radius: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1 id="current-round-title">იტვირთება...</h1>

    <div class="controls">
        <button onclick="filterRound(1)">რაუნდი I</button>
        <button onclick="filterRound(2)">ბარათონი</button>
        <button onclick="filterRound(3)">პაპა კარლო</button>
        <button onclick="filterRound(4)">რაუნდი IV</button>
    </div>

    <div id="quiz-container"></div>

    <script>
        const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTPbFyJhfjucAuCP4lUcZVjh2yiMChHcSxGjqIAWc8ixsSaIWeVVjTPKCxJyKJXkL8cAFe2mYwuFMuF/pub?output=csv";
        let allData = [];
        let activeIntervals = {};

        // მონაცემების წამოღება
        Papa.parse(csvUrl, {
            download: true,
            header: false,
            skipEmptyLines: true,
            complete: function(results) {
                allData = results.data;
                console.log("მონაცემები ჩაიტვირთა!");
                filterRound(1);
            }
        });

        window.filterRound = function(num) {
            // ტაიმერების გასუფთავება
            Object.values(activeIntervals).forEach(clearInterval);
            activeIntervals = {};

            const container = document.getElementById('quiz-container');
            container.innerHTML = "";
            
            const titles = { 1: "რაუნდი I", 2: "ბარათონი", 3: "პაპა კარლო", 4: "რაუნდი IV" };
            document.getElementById('current-round-title').innerText = titles[num];

            const filtered = allData.filter(row => row[0] && row[0].trim() == num.toString());

            if (filtered.length === 0) {
                container.innerHTML = "<p>ამ რაუნდში კითხვები ვერ მოიძებნა.</p>";
                return;
            }

            filtered.forEach((row, index) => {
                let q = row[1] || ""; 
                let a = row[2] || ""; 
                const timerId = `timer-${index}`;
                let isImg = q.includes('http');

                const div = document.createElement('div');
                div.className = 'question-card';
                div.innerHTML = `
                    ${isImg ? `<img src="${q}" class="q-img">` : `<div style="font-size:1.2rem; font-weight:bold; margin-bottom:10px;">${q}</div>`}
                    <div class="timer-container">
                        <button style="background:#27ae60; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;" onclick="startTimer('${timerId}', 20, this)">⏱️ 20წ</button>
                        <div id="${timerId}" class="timer-display">20</div>
                    </div>
                    <button style="background:#3498db; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;" onclick="this.nextElementSibling.style.display='block'; this.style.display='none'">პასუხის ნახვა</button>
                    <div class="ans-text">✅ პასუხი: ${a}</div>
                `;
                container.appendChild(div);
            });
            window.scrollTo(0,0);
        };

        window.startTimer = function(id, dur, btn) {
            if (activeIntervals[id]) return;
            let t = dur;
            btn.disabled = true;
            btn.style.opacity = "0.5";
            activeIntervals[id] = setInterval(() => {
                t--;
                document.getElementById(id).textContent = t;
                if(t <= 0) {
                    clearInterval(activeIntervals[id]);
                    document.getElementById(id).textContent = "⌛ დრო ამოიწურა!";
                }
            }, 1000);
        };
    </script>
</body>
</html>
