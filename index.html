<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>áƒ˜áƒáƒ–áƒ áƒáƒ•áƒœáƒ” áƒ˜áƒ›áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡, áƒ áƒáƒ› áƒ˜áƒáƒ áƒ¡áƒ”áƒ‘áƒ!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; text-align: center; padding: 20px; margin: 0; }
        .header-title { font-size: 2.2rem; color: #f1c40f; margin-top: 30px; font-weight: bold; }
        
        /* áƒáƒáƒ™áƒ”áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ”áƒœáƒ˜áƒ£ */
        .menu-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .package-card { background: #1e293b; padding: 25px; border-radius: 15px; cursor: pointer; border: 2px solid #334155; transition: 0.3s; }
        .package-card:hover { transform: translateY(-5px); border-color: #f1c40f; }

        /* áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ¡ áƒ‘áƒáƒ áƒáƒ—áƒ˜áƒ¡ áƒáƒ®áƒáƒšáƒ˜ áƒ¡áƒ¢áƒ˜áƒšáƒ˜ */
        .question-card { 
            background: white; 
            padding: 25px; 
            border-radius: 20px; 
            color: #1e293b; 
            text-align: left; 
            margin-bottom: 35px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border-left: 8px solid #3b82f6;
        }

        /* áƒ—áƒ”áƒ›áƒ˜áƒ¡áƒ áƒ“áƒ áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ¡ áƒœáƒáƒ›áƒ áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ¡áƒáƒ§áƒáƒ¤áƒ˜ áƒ¡áƒ¢áƒ˜áƒšáƒ˜ */
        .theme-badge {
            display: inline-block;
            background: #3b82f6;
            color: white;
            padding: 5px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .question-number-badge {
            display: inline-block;
            background: #f1f5f9;
            color: #475569;
            padding: 5px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-left: 5px;
            border: 1px solid #e2e8f0;
        }

        /* áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ¡ áƒ«áƒ˜áƒ áƒ˜áƒ—áƒáƒ“áƒ˜ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ */
        .question-body {
            font-size: 1.15rem;
            line-height: 1.7;
            margin: 15px 0;
            color: #1e293b;
            font-weight: 500;
        }

        /* áƒ¢áƒáƒ˜áƒ›áƒ”áƒ áƒ˜ áƒ“áƒ áƒ¦áƒ˜áƒšáƒáƒ™áƒ”áƒ‘áƒ˜ */
        .timer-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8fafc;
            padding: 12px 20px;
            border-radius: 12px;
            margin-top: 15px;
        }
        .timer-val { font-size: 1.5rem; font-weight: bold; color: #ef4444; }
        
        .btn-ans { 
            width: 100%; 
            margin-top: 15px;
            padding: 12px; 
            background: #1e293b; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            font-weight: bold; 
            cursor: pointer;
        }
        .ans-box { 
            display: none; 
            margin-top: 15px; 
            padding: 15px; 
            background: #dcfce7; 
            color: #166534; 
            border-radius: 10px; 
            font-weight: bold; 
            border-left: 5px solid #22c55e; 
        }

        .instruction-box { background: #f1c40f; color: #0f172a; padding: 15px; border-radius: 12px; margin-bottom: 30px; font-weight: bold; }
        .controls button { padding: 10px 18px; background: #f1c40f; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin: 5px; }
        .back-btn { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="home-page">
        <h1 class="header-title">áƒ˜áƒáƒ–áƒ áƒáƒ•áƒœáƒ” áƒ˜áƒ›áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡, áƒ áƒáƒ› áƒ˜áƒáƒ áƒ¡áƒ”áƒ‘áƒ!</h1>
        <div id="menu-container" class="menu-container"></div>
    </div>

    <div id="game-zone" style="display:none; max-width: 800px; margin: 0 auto;">
        <button class="back-btn" onclick="location.reload()">â¬…ï¸ áƒ›áƒ”áƒœáƒ˜áƒ£</button>
        <h2 id="pkg-name" style="color:#f1c40f;"></h2>
        <div class="controls">
            <button onclick="filterRound(1)">áƒ áƒáƒ£áƒœáƒ“áƒ˜ I</button>
            <button onclick="filterRound(2)">áƒ‘áƒáƒ áƒáƒ—áƒáƒœáƒ˜</button>
            <button onclick="filterRound(3)">áƒáƒáƒáƒ áƒ™áƒáƒ áƒšáƒ</button>
            <button onclick="filterRound(4)">áƒ áƒáƒ£áƒœáƒ“áƒ˜ IV</button>
        </div>
        <div id="quiz-container"></div>
    </div>

    <script>
        const S_URL = "https://jaxqzgnjanbnyvhrnlwu.supabase.co";
        const S_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpheHF6Z25qYW5ibnl2aHJubHd1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxNjY5NDAsImV4cCI6MjA4Mjc0Mjk0MH0.Wfcqhe5aJlFhwknTfol5_lcdKVcNQFjJqj0X7U5WLu4";
        const _db = supabase.createClient(S_URL, S_KEY);

        let activeData = [];
        let intervals = {};

        async function init() {
            const { data } = await _db.from('packages').select('*').order('rating', { ascending: false });
            const container = document.getElementById('menu-container');
            data.forEach(pkg => {
                const div = document.createElement('div');
                div.className = 'package-card';
                div.onclick = () => {
                    document.getElementById('home-page').style.display='none';
                    document.getElementById('game-zone').style.display='block';
                    document.getElementById('pkg-name').innerText = pkg.title;
                    Papa.parse(pkg.csv_url, { download: true, complete: (r) => { activeData = r.data; filterRound(1); } });
                };
                div.innerHTML = `<div style="font-size:2.5rem;">${pkg.icon || 'ğŸ’¡'}</div><h3>${pkg.title}</h3><p>áƒáƒ•áƒ¢áƒáƒ áƒ˜: ${pkg.author_name}</p>`;
                container.appendChild(div);
            });
        }

        window.filterRound = function(n) {
            Object.values(intervals).forEach(clearInterval);
            const cont = document.getElementById('quiz-container');
            cont.innerHTML = "";
            
            const rows = activeData.filter(r => r[0] && r[0].toString().trim() === n.toString());
            rows.forEach((r, i) => {
                let rawQ = r[1] || ""; let a = r[2] || "";
                
                if (rawQ.toLowerCase().startsWith("áƒ˜áƒœáƒ¡áƒ¢áƒ áƒ£áƒ¥áƒªáƒ˜áƒ:")) {
                    cont.innerHTML += `<div class="instruction-box">ğŸ’¡ ${rawQ}</div>`;
                    return;
                }

                // áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ¡ áƒ“áƒáƒœáƒáƒ¬áƒ”áƒ•áƒ áƒ”áƒ‘áƒ: áƒ•áƒ”áƒ«áƒ”áƒ‘áƒ— "áƒ—áƒ”áƒ›áƒ X:" áƒ“áƒ "áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ X:"
                let themePart = rawQ.match(/áƒ—áƒ”áƒ›áƒ\s*\d+[:\s]*/i) || "";
                let questPart = rawQ.match(/áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ\s*\d+[:\s]*/i) || "";
                let cleanText = rawQ.replace(themePart, "").replace(questPart, "").trim();

                const tid = `t-${i}`;
                const card = document.createElement('div');
                card.className = 'question-card';
                card.innerHTML = `
                    <div>
                        ${themePart ? `<span class="theme-badge">ğŸ·ï¸ ${themePart}</span>` : ''}
                        ${questPart ? `<span class="question-number-badge"># ${questPart}</span>` : ''}
                    </div>
                    <div class="question-body">${cleanText.includes('http') ? `<img src="${cleanText}" style="width:100%; border-radius:10px;">` : cleanText}</div>
                    <div class="timer-box">
                        <button onclick="startTimer('${tid}', 20, this)" style="cursor:pointer; padding:5px 10px; border-radius:5px; border:1px solid #cbd5e1;">â±ï¸ áƒ©áƒáƒ áƒ—áƒ•áƒ</button>
                        <div id="${tid}" class="timer-val">20</div>
                    </div>
                    <button class="btn-ans" onclick="this.nextElementSibling.style.display='block'; this.style.display='none'">áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒ</button>
                    <div class="ans-box">âœ… ${a}</div>
                `;
                cont.appendChild(card);
            });
        };

        window.startTimer = function(id, s, btn) {
            btn.disabled = true;
            let left = s;
            intervals[id] = setInterval(() => {
                left--;
                document.getElementById(id).innerText = left;
                if(left <= 0) { clearInterval(intervals[id]); document.getElementById(id).innerText = "âŒ›"; }
            }, 1000);
        };

        init();
    </script>
</body>
</html>
